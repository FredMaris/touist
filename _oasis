# `_oasis` contains the configuration for launching `oasis setup`,
# which creates the ./configure + Makefile for the project.
# Running `oasis setup` is only required when _oasis is modified.
#
# Note that menhirLib is required to be >= 20150118 because the feature
# "incremental API" has been introduced at that version.
###############
# To install oasis:
#     opam install oasis
# To install menhir, fileutils:
#     opam install menhir fileutils minisat
###############
# To force using 'bytecode' over 'native' binary for debugging with
# ocamldebug or utop, launch:
#     ./configure --override is_native false
#
###############
# To distribute to OPAM,
# - modify the 'Version:' field; this field will be used for creating
#   the version.ml instead of using 'git describe --tags' because git
#   information is not available in archive tar.gz from github.
# - 1. `oasis setup`
#       `oasis2opam --local`
#       `git add setup.ml _oasis opam/opam`
#       `git commit -m "Bump to v2.4.0"`
#    NOTE: these three steps can be done with 'make version VERSION=2.4.0'
# 2. create the tag, for example `git tag -s v2.4.0`
# 3. push all that: `git push --tags`
# 4. run `oasis2opam https://github.com/touist/touist/archive/v2.4.0.tar.gz`
# 5. run `opam-publish submit touist.2.4.0`

OASISFormat:  0.4
OcamlVersion: >= 4.01.0
Name:         touist
Version:      3.0.1
Synopsis:     The solver for the Touist language
Description:  The Touist language is a friendly language for writing
  propositional logic and logic on real and integers (SMT). This language
  aims to formalize real-life problems (e.g., the sudoku can be solved in a
  few lines). Touist embeds the minisat solver (for propositional logic) and
  (coming soon) the SMT2 solver. It can also generate the DIMACS, SMT2 and
  latex formats from you touist file.
Maintainers:  Maël Valais <mael.valais@gmail.com>
Authors:      Maël Valais <mael.valais@gmail.com>, Olivier Lezaud
Homepage:     http://touist.github.io
License:      MIT
Plugins:      META (0.4), DevFiles (0.4)
BuildType: ocamlbuild (0.4)
AlphaFeatures: ocamlbuild_more_args

PreBuildCommand: make pre-build
PostCleanCommand: make clean-pre-build

XOCamlbuildExtraArgs: -use-menhir -menhir \"menhir --table --inspection -v -la 2 --explain\"

# IMPORTANT: the library name is 'touist', so when calling ocamlc we must add
#     ocamlfind ocamlc -pkg Touist
# but inside of the .ml files that use the functions, you just have to do:
#     open Parse                                  (or Sat, Smt, Eval...)
# I know that it is confusing for now: we should be able to do '-pkg touist'
# and 'open Touist'...
Library touistLib
  Path:           src/lib
  Install:        false
  Modules:        Parse,Eval,Cnf,Sat,Smt,Pprint,Latex,Msgs
  InternalModules: Lexer,Parser,Parser_error_report,Types
  BuildTools:     ocamlbuild, menhir
  BuildDepends:   menhirLib (>= 20150118), fileutils (>= 0.4.0), re.str, minisat

Executable touist
  CompiledObject: best
  Path:           src/cli
  BuildTools:     ocamlbuild, menhir
  MainIs:         touist.ml
  BuildDepends:   touistLib

# This produces touist.byte, useful for ocamldebug.
# To enable it, ./configure --enable-debug
Executable touist-debug
  Build$:         flag(debug)
  CompiledObject: byte
  Path:           src/cli
  BuildTools:     ocamlbuild, menhir
  MainIs:         touist.ml
  BuildDepends:   touistLib

# This produces the test.byte executable; to enable it,
# ./configure --enable-tests
Executable test
  Build$:         flag(tests)
  Install:        false
  Path:           test
  MainIs:         test.ml
  BuildTools:     ocamlbuild, menhir, touist
  BuildDepends:   touistLib, oUnit

Executable touistjs
  Build: true
  Install: false
  CompiledObject: byte
  Path: src/js
  MainIs: touistjs.ml
  BuildTools: ocamlbuild, js_of_ocaml
  BuildDepends: js_of_ocaml, js_of_ocaml.ppx, touistLib

Test test
  Run$: flag(tests)
  Command:          $test
  WorkingDirectory: .
  TestTools: test

Document touistLib
  Title: API reference for the Touist compiler
  Type: ocamlbuild (0.4)
  Install: false
  InstallDir: $htmldir/api
  BuildTools+: ocamldoc,ocamlbuild
  XOCamlbuildPath: src/lib
  XOCamlbuildLibraries: touistLib
  XOCamlbuildExtraArgs: -docflags \"-colorize-code -short-functors -charset utf-8\"
  XOCamlbuildExtraArgs+:-use-menhir -menhir \"menhir --table --inspection -v -la 2\"

SourceRepository master
  Type:           git
  Location:       https://github.com/touist/touist.git
  Browser:        https://github.com/touist/touist
